O(n(M+n^2))