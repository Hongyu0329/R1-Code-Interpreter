import sys

def solve_ccsd_question():
    """
    Explains and solves the problem regarding zero matrix elements in CCSD.
    """
    # Block 1: State the problem and fundamental principles
    print("### Analyzing the CCSD Matrix Elements <Phi_I | H_bar | Phi> ###")
    print("\n--- Step 1: Stating the Premises ---")
    h_body_rank = 2
    print(f"Premise 1: The electronic Hamiltonian (H) contains up to {h_body_rank}-body terms.")
    print("Premise 2: In CCSD, matrix elements for singly (k=1) and doubly (k=2) excited")
    print("           determinants are set to zero to determine the cluster amplitudes.")

    # Block 2: The key insight from many-body theory
    print("\n--- Step 2: Structure of the Transformed Hamiltonian (H_bar) ---")
    h_bar_max_body_rank = 4
    print("A key result from many-body theory is that for a two-body Hamiltonian, the")
    print(f"similarity-transformed Hamiltonian (H_bar) contains at most {h_bar_max_body_rank}-body operators.")

    # Block 3: Consequence for the state H_bar | Phi >
    print("\n--- Step 3: Excitation Levels in H_bar|Phi> ---")
    print("When an operator with a maximum rank of n-body acts on the reference determinant |Phi>,")
    print("it can create, at most, n-tuply excited determinants.")
    print(f"Therefore, the state H_bar|Phi> contains excited determinants up to rank {h_bar_max_body_rank} (Quadruples).")
    print("It has NO components from pentuply (k=5), hextuply (k=6), or higher excited determinants.")

    # Block 4: Final Conclusion using Orthogonality
    print("\n--- Step 4: Identifying Other Zero Matrix Elements ---")
    print("The matrix element <Phi_I | H_bar | Phi> is a projection.")
    print("Due to the orthogonality of Slater determinants, this projection is only non-zero if the")
    print("excitation level of |Phi_I> exists in the expansion of H_bar|Phi>.")

    print("\n------------------------- CONCLUSION -------------------------")
    print("The matrix elements <Phi_I | H_bar | Phi> are zero by construction for:")
    print("- Singly excited determinants (k=1)")
    print("- Doubly excited determinants (k=2)")
    
    print("\nThey are generally NON-ZERO for:")
    print("- Triply excited determinants (k=3)")
    print("- Quadruply excited determinants (k=4)")

    print("\nThey are automatically ZERO due to the operator structure for:")
    answer_determinants = []
    # All excitation levels higher than the max rank generated by H_bar|Phi>
    # are guaranteed to have zero projection.
    higher_excitations = {
        5: "Pentuply",
        6: "Hextuply",
        7: "Septuply"
    }
    for k in range(5, 8):
        name = higher_excitations[k]
        answer_determinants.append(f"- {name} excited determinants (k={k})")

    for det in answer_determinants:
        print(det)
    print("- ... and all other higher excited determinants (k > 4).")
    print("----------------------------------------------------------")


if __name__ == "__main__":
    solve_ccsd_question()
