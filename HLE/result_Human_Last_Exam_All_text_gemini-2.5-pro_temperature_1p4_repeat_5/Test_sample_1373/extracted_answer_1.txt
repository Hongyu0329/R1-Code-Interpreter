O(Mn + n^2)