O(n²d² + n³)