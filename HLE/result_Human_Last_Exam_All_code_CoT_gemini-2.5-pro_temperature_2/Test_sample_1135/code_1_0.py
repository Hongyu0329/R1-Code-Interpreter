def solve_ccsd_matrix_element_question():
    """
    This script explains for which excited Slater determinants |Phi_I>
    the matrix element <Phi_I | H_bar | Phi> is zero in CCSD,
    based on the properties of the Hamiltonian.
    """

    # --- Introduction ---
    print("Analysis of the CCSD matrix element <Phi_I | H_bar | Phi>")
    print("=" * 60)
    print("In the CCSD method, the similarity-transformed Hamiltonian is H_bar = exp(-T) * H * exp(T),")
    print("where the cluster operator is T = T1 + T2.")
    print("The amplitude equations are set by forcing the projection of the Schrodinger equation onto")
    print("the space of singly (S) and doubly (D) excited determinants to be zero:")
    print("1. <Phi_S | H_bar | Phi> = 0  (by construction)")
    print("2. <Phi_D | H_bar | Phi> = 0  (by construction)")
    print("\nWe need to find for which OTHER excitation levels this matrix element is also zero.\n")

    # --- Main Argument ---
    print("Step 1: The structure of the state H_bar | Phi>")
    print("-" * 60)
    print("The value of <Phi_I | H_bar | Phi> is the coefficient of the |Phi_I> component in the")
    print("state vector |Psi_CC> = H_bar | Phi>. Due to the linked-diagram theorem, this can be written as:")
    print("|Psi_CC> = (H * exp(T))_c | Phi>")
    print("This means |Psi_CC> is a sum of all connected diagrams containing one H vertex and any")
    print("number of T1 and T2 operators acting on the reference determinant |Phi>.")
    print()

    print("Step 2: The 'Two-Body' Nature of the Hamiltonian (H)")
    print("-" * 60)
    print("The electronic Hamiltonian H contains one- and two-body interactions. This is the key physical constraint.")
    print("In diagrammatic terms, the H vertex has at most 4 'legs' (it can interact with at most 2 electrons simultaneously).")
    print()

    print("Step 3: The Connectivity Argument and Maximum Excitation Level")
    print("-" * 60)
    print("To generate an N-fold excited state, the diagram must have N external particle-hole pairs.")
    print("All operators in the diagram must be connected through the single H vertex.")
    print("Since the H vertex has only 4 legs, it can link a maximum of 4 lines from the T operators.")
    print("This limits the total number of particle-hole pairs that can be left free (external).")
    print("\nLet's consider the maximum number of excitations generated by connected terms:")
    # Using 'e-' as a shorthand for 'excitations'
    print("   - (H * T1)_c                  -> max 3 e- (triples)")
    print("   - (H * T2)_c                  -> max 4 e- (quadruples)")
    print("   - (H * T1 * T1)_c             -> max 4 e- (quadruples)")
    print("   - (H * T1 * T2)_c             -> max 4 e- (quadruples)")
    print("   - (H * T2 * T2)_c             -> max 4 e- (quadruples)")
    print("\nIt is impossible to form a connected diagram with 5 or more external particle-hole pairs")
    print("because there are not enough 'legs' on the single H vertex to connect the required T operators.")
    print()

    # --- Conclusion ---
    print("Conclusion")
    print("=" * 60)
    print("The state vector |Psi_CC> = H_bar | Phi> has components up to quadruply excited determinants,")
    print("but no components from quintuply excited determinants or higher.")
    print("Therefore:")
    print(" - <Phi_T | H_bar | Phi> is generally NON-ZERO (T=Triples).")
    print(" - <Phi_Q | H_bar | Phi> is generally NON-ZERO (Q=Quadruples).")
    print(" - <Phi_P | H_bar | Phi> is IDENTICALLY ZERO (P=Quintuples).")
    print(" - <Phi_H | H_bar | Phi> is IDENTICALLY ZERO (H=Hextuples), etc.")
    print()
    print("The 'other' excited Slater determinants for which the matrix element is zero are those")
    print("with an excitation level of 5 or greater.")

solve_ccsd_matrix_element_question()