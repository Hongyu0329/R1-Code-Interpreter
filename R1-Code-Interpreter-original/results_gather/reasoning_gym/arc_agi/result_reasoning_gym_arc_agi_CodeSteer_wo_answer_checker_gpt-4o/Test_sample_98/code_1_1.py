def transform_grid_optimized(input_grid):
    rows = len(input_grid)
    cols = len(input_grid[0])
    output_grid = [[input_grid[i][j] for j in range(cols)] for i in range(rows)]

    # Store positions of '5' and '2'
    positions_5 = []
    positions_2 = []

    for i in range(rows):
        for j in range(cols):
            if input_grid[i][j] == 5:
                positions_5.append((i, j))
            elif input_grid[i][j] == 2:
                positions_2.append((i, j))

    # Propagate '5' diagonally downwards to the right
    for i, j in positions_5:
        x, y = i, j
        while x < rows and y < cols:
            output_grid[x][y] = 5
            x += 1
            y += 1

    # Propagate '2' diagonally upwards to the left
    for i, j in positions_2:
        x, y = i, j
        while x >= 0 and y >= 0:
            output_grid[x][y] = 2
            x -= 1
            y -= 1

    return output_grid

# Test input grid
input_grid = [
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 4],
    [4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
    [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
]

output_grid = transform_grid_optimized(input_grid)

# Print the output grid
for row in output_grid:
    print(' '.join(map(str, row)))